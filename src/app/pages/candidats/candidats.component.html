<div class="page-header">
  <h1>Gestion des Candidats</h1>
  <button class="btn-primary" (click)="openCreateModal()">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    Nouveau Candidat
  </button>
</div>

<div class="content-card">
  <div class="card-header">
    <h2>Liste des Candidats</h2>
    <p class="card-subtitle">Gérez les candidats et leurs évaluations</p>
  </div>

  <div class="search-bar">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
      <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <input type="text" placeholder="Rechercher un candidat..." [(ngModel)]="searchQuery" (input)="onSearch()"/>
  </div>

  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>N° Dossier</th>
          <th>Nom Complet</th>
          <th>Auto-École</th>
          <th>Type Permis</th>
          <th>Date Évaluation</th>
          <th>Inspecteur</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let candidat of filteredCandidats">
          <td><span class="dossier-number">{{ candidat.numeroDossier }}</span></td>
          <td>{{ candidat.prenom }} {{ candidat.nom }}</td>
          <td>{{ candidat.autoEcole }}</td>
          <td><span class="type-badge">{{ candidat.typePermis }}</span></td>
          <td>{{ candidat.dateEvaluation | date: 'dd/MM/yyyy' }}</td>
          <td>{{ candidat.inspecteurMatricule || 'Non assigné' }}</td>
          <td>
            <span class="badge" [class.badge-success]="candidat.estEvalue" [class.badge-pending]="!candidat.estEvalue">
              {{ candidat.estEvalue ? 'Évalué' : 'En attente' }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn-icon" (click)="openEditModal(candidat)" title="Modifier">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M18.5 2.50001C18.8978 2.10219 19.4374 1.87869 20 1.87869C20.5626 1.87869 21.1022 2.10219 21.5 2.50001C21.8978 2.89784 22.1213 3.4374 22.1213 4.00001C22.1213 4.56262 21.8978 5.10219 21.5 5.50001L12 15L8 16L9 12L18.5 2.50001Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <button class="btn-icon btn-danger" (click)="deleteCandidat(candidat)" title="Supprimer">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <polyline points="3 6 5 6 21 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Modifier le Candidat' : 'Nouveau Candidat' }}</h2>
      <button class="close-btn" (click)="closeModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <p class="modal-description">
      {{ isEditMode ? 'Modifiez les informations du candidat.' : 'Créez un nouveau candidat pour évaluation.' }}
    </p>

    <form (ngSubmit)="onSubmit()">
      <div class="form-row">
        <div class="form-group">
          <label for="nom">Nom</label>
          <input
            type="text"
            id="nom"
            name="nom"
            [(ngModel)]="candidatForm.nom"
            placeholder="Nom du candidat"
            required
          />
        </div>

        <div class="form-group">
          <label for="prenom">Prénom</label>
          <input
            type="text"
            id="prenom"
            name="prenom"
            [(ngModel)]="candidatForm.prenom"
            placeholder="Prénom du candidat"
            required
          />
        </div>
      </div>

      <div class="form-group">
        <label for="numeroDossier">Numéro de Dossier</label>
        <input
          type="text"
          id="numeroDossier"
          name="numeroDossier"
          [(ngModel)]="candidatForm.numeroDossier"
          placeholder="Ex: 20251202AB11"
          [disabled]="isEditMode"
          required
        />
      </div>

      <div class="form-group">
        <label for="autoEcole">Auto-École</label>
        <input
          type="text"
          id="autoEcole"
          name="autoEcole"
          [(ngModel)]="candidatForm.autoEcole"
          placeholder="Nom de l'auto-école"
          required
        />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="typePermis">Type de Permis</label>
          <select
            id="typePermis"
            name="typePermis"
            [(ngModel)]="candidatForm.typePermis"
            required
          >
            <option value="">Sélectionner un type</option>
            <option *ngFor="let type of typesPermis" [value]="type.code">
              {{ type.libelle }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="dateEvaluation">Date d'Évaluation</label>
          <input
            type="date"
            id="dateEvaluation"
            name="dateEvaluation"
            [(ngModel)]="candidatForm.dateEvaluation"
            required
          />
        </div>
      </div>

      <div class="form-group" *ngIf="!isEditMode">
        <label for="inspecteurMatricule">Inspecteur (Optionnel)</label>
        <select
          id="inspecteurMatricule"
          name="inspecteurMatricule"
          [(ngModel)]="candidatForm.inspecteurMatricule"
        >
          <option value="">Non assigné</option>
          <option *ngFor="let inspecteur of inspecteurs" [value]="inspecteur.matricule">
            {{ inspecteur.prenom }} {{ inspecteur.nom }} ({{ inspecteur.matricule }})
          </option>
        </select>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeModal()">Annuler</button>
        <button type="submit" class="btn-primary" [disabled]="loading">
          {{ isEditMode ? 'Enregistrer' : 'Créer' }}
        </button>
      </div>
    </form>
  </div>
</div>
