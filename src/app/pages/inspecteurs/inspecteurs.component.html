<div class="page-header">
  <h1>Gestion des Inspecteurs</h1>
  <button class="btn-primary" (click)="openCreateModal()">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    Nouvel Inspecteur
  </button>
</div>

<div class="content-card">
  <div class="card-header">
    <div>
      <h2>Liste des Inspecteurs</h2>
      <p class="card-subtitle">Gérez les inspecteurs et leurs affectations</p>
    </div>
    <div class="view-toggle">
      <button class="btn-icon" [class.active]="viewMode === 'grid'" (click)="toggleViewMode('grid')" title="Vue grille">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="3" width="7" height="7" stroke="currentColor" stroke-width="2"/>
          <rect x="14" y="3" width="7" height="7" stroke="currentColor" stroke-width="2"/>
          <rect x="3" y="14" width="7" height="7" stroke="currentColor" stroke-width="2"/>
          <rect x="14" y="14" width="7" height="7" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
      <button class="btn-icon" [class.active]="viewMode === 'table'" (click)="toggleViewMode('table')" title="Vue tableau">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <line x1="4" y1="4" x2="20" y2="4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="4" y1="12" x2="20" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="4" y1="20" x2="20" y2="20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="8" y1="2" x2="8" y2="22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="16" y1="2" x2="16" y2="22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="search-bar">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org2000/svg">
      <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
      <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <input
      type="text"
      placeholder="Rechercher un inspecteur..."
      [(ngModel)]="searchQuery"
      (input)="onSearch()"
    />
  </div>

  <!-- Vue Grille -->
  <div class="inspecteurs-grid" *ngIf="viewMode === 'grid'">
    <div class="inspecteur-card" *ngFor="let inspecteur of filteredInspecteurs">
      <div class="inspecteur-avatar">{{ getInitials(inspecteur) }}</div>
      <div class="inspecteur-info">
        <h3>{{ inspecteur.prenom }} {{ inspecteur.nom }}</h3>
        <p class="inspecteur-matricule">{{ inspecteur.matricule }}</p>
        <p class="inspecteur-grade">{{ inspecteur.grade || 'Inspecteur' }}</p>
        <p class="inspecteur-zone">{{ inspecteur.zoneAffectation || 'Non affecté' }}</p>
      </div>
      <div class="inspecteur-actions">
        <button class="btn-icon" (click)="openEditModal(inspecteur)" title="Modifier">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M18.5 2.50001C18.8978 2.10219 19.4374 1.87869 20 1.87869C20.5626 1.87869 21.1022 2.10219 21.5 2.50001C21.8978 2.89784 22.1213 3.4374 22.1213 4.00001C22.1213 4.56262 21.8978 5.10219 21.5 5.50001L12 15L8 16L9 12L18.5 2.50001Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button class="btn-icon btn-danger" (click)="deleteInspecteur(inspecteur)" title="Supprimer">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <polyline points="3 6 5 6 21 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Vue Tableau -->
  <div class="table-container" *ngIf="viewMode === 'table'">
    <table class="data-table">
      <thead>
        <tr>
          <th>Matricule</th>
          <th>Nom Complet</th>
          <th>Téléphone</th>
          <th>Email</th>
          <th>Grade</th>
          <th>Zone</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let inspecteur of filteredInspecteurs">
          <td><span class="dossier-number">{{ inspecteur.matricule }}</span></td>
          <td>{{ inspecteur.prenom }} {{ inspecteur.nom }}</td>
          <td>{{ inspecteur.telephone }}</td>
          <td>{{ inspecteur.email || '-' }}</td>
          <td>{{ inspecteur.grade || '-' }}</td>
          <td>{{ inspecteur.zoneAffectation || '-' }}</td>
          <td>
            <span class="badge badge-active">{{ inspecteur.statut }}</span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn-icon" (click)="openEditModal(inspecteur)" title="Modifier">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M18.5 2.50001C18.8978 2.10219 19.4374 1.87869 20 1.87869C20.5626 1.87869 21.1022 2.10219 21.5 2.50001C21.8978 2.89784 22.1213 3.4374 22.1213 4.00001C22.1213 4.56262 21.8978 5.10219 21.5 5.50001L12 15L8 16L9 12L18.5 2.50001Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <button class="btn-icon btn-danger" (click)="deleteInspecteur(inspecteur)" title="Supprimer">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <polyline points="3 6 5 6 21 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal pour créer/modifier un inspecteur -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Modifier l\'Inspecteur' : 'Nouvel Inspecteur' }}</h2>
      <button class="close-btn" (click)="closeModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <p class="modal-description">
      {{ isEditMode ? 'Modifiez les informations de l\'inspecteur.' : 'Créez un nouvel inspecteur.' }}
    </p>

    <form (ngSubmit)="onSubmit()">
      <div class="form-row">
        <div class="form-group">
          <label for="matricule">Matricule</label>
          <input
            type="text"
            id="matricule"
            name="matricule"
            [(ngModel)]="inspecteurForm.matricule"
            placeholder="Ex: DTR-123"
            [disabled]="isEditMode"
            required
          />
        </div>
        <div class="form-group">
          <label for="username">Nom d'utilisateur</label>
          <input
            type="text"
            id="username"
            name="username"
            [(ngModel)]="inspecteurForm.username"
            placeholder="Nom d'utilisateur"
            required
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="nom">Nom</label>
          <input
            type="text"
            id="nom"
            name="nom"
            [(ngModel)]="inspecteurForm.nom"
            placeholder="Nom de famille"
            required
          />
        </div>
        <div class="form-group">
          <label for="prenom">Prénom</label>
          <input
            type="text"
            id="prenom"
            name="prenom"
            [(ngModel)]="inspecteurForm.prenom"
            placeholder="Prénom"
            required
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="telephone">Téléphone</label>
          <input
            type="tel"
            id="telephone"
            name="telephone"
            [(ngModel)]="inspecteurForm.telephone"
            placeholder="Ex: 771234567"
            required
          />
        </div>
        <div class="form-group">
          <label for="email">Email (optionnel)</label>
          <input
            type="email"
            id="email"
            name="email"
            [(ngModel)]="inspecteurForm.email"
            placeholder="email@exemple.sn"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="grade">Grade (optionnel)</label>
          <input
            type="text"
            id="grade"
            name="grade"
            [(ngModel)]="inspecteurForm.grade"
            placeholder="Ex: Inspecteur Principal"
          />
        </div>
        <div class="form-group">
          <label for="zoneAffectation">Zone d'affectation (optionnel)</label>
          <input
            type="text"
            id="zoneAffectation"
            name="zoneAffectation"
            [(ngModel)]="inspecteurForm.zoneAffectation"
            placeholder="Ex: Dakar-Centre"
          />
        </div>
      </div>

      <div class="form-group">
        <label for="password">{{ isEditMode ? 'Mot de passe (laisser vide pour ne pas modifier)' : 'Mot de passe' }}</label>
        <input
          type="password"
          id="password"
          name="password"
          [(ngModel)]="inspecteurForm.password"
          placeholder="********"
          [required]="!isEditMode"
        />
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeModal()">Annuler</button>
        <button type="submit" class="btn-primary" [disabled]="loading">
          {{ isEditMode ? 'Enregistrer' : 'Créer' }}
        </button>
      </div>
    </form>
  </div>
</div>