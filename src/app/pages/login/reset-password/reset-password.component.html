<div class="reset-password-container">
  <div class="reset-password-card">
    <div class="reset-password-header">
      <div class="logo">
        <img src="./assets/logo_epermis.png" alt="E-Permis Sénégal" width="80" height="80"/>
      </div>
      
      <div *ngIf="verifyingToken" class="verifying-state">
        <svg class="spinner" width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke="#E2E8F0" stroke-width="4"/>
          <path d="M12 2C13.3132 2 14.6136 2.25866 15.8268 2.7612C17.0401 3.26375 18.1425 4.00035 19.0711 4.92893C19.9997 5.85752 20.7362 6.95991 21.2388 8.17317C21.7413 9.38642 22 10.6868 22 12" stroke="#0F5E3E" stroke-width="4" stroke-linecap="round"/>
        </svg>
        <h2>Vérification du lien...</h2>
        <p>Validation du lien de réinitialisation en cours</p>
      </div>

      <div *ngIf="!verifyingToken && tokenValid">
        <h1>Réinitialiser votre mot de passe</h1>
        <p class="subtitle">Choisissez un nouveau mot de passe sécurisé</p>
      </div>
    </div>

    <div *ngIf="!verifyingToken && !tokenValid && error" class="error-state">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="10" stroke="#DC2626" stroke-width="2"/>
        <line x1="12" y1="8" x2="12" y2="12" stroke="#DC2626" stroke-width="2" stroke-linecap="round"/>
        <line x1="12" y1="16" x2="12.01" y2="16" stroke="#DC2626" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <h3>Lien invalide ou expiré</h3>
      <p>{{ error }}</p>
      <p>Redirection vers la page de réinitialisation...</p>
    </div>

    <form *ngIf="!verifyingToken && tokenValid" (ngSubmit)="onSubmit()" class="reset-password-form">

      <div class="form-group">
        <label for="newPassword">Nouveau mot de passe</label>
        <div class="password-input-wrapper">
          <input
            [type]="showNewPassword ? 'text' : 'password'"
            id="newPassword"
            name="newPassword"
            [(ngModel)]="newPassword"
            placeholder="Entrez votre nouveau mot de passe"
            [disabled]="loading"
            required
          />
          <button 
            type="button" 
            class="password-toggle" 
            (click)="togglePasswordVisibility('new')"
            [disabled]="loading"
            tabindex="-1"
          >
            <svg *ngIf="!showNewPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            <svg *ngIf="showNewPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
              <line x1="1" y1="1" x2="23" y2="23"></line>
            </svg>
          </button>
        </div>
        <p class="form-hint">
          Minimum 8 caractères, avec majuscule, minuscule, chiffre et caractère spécial
        </p>
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirmer le nouveau mot de passe</label>
        <div class="password-input-wrapper">
          <input
            [type]="showConfirmPassword ? 'text' : 'password'"
            id="confirmPassword"
            name="confirmPassword"
            [(ngModel)]="confirmPassword"
            placeholder="Confirmez votre nouveau mot de passe"
            [disabled]="loading"
            required
          />
          <button 
            type="button" 
            class="password-toggle" 
            (click)="togglePasswordVisibility('confirm')"
            [disabled]="loading"
            tabindex="-1"
          >
            <svg *ngIf="!showConfirmPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            <svg *ngIf="showConfirmPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
              <line x1="1" y1="1" x2="23" y2="23"></line>
            </svg>
          </button>
        </div>
      </div>

      <div *ngIf="error" class="error-message">
        {{ error }}
      </div>

      <div *ngIf="success" class="success-message">
        ✓ Mot de passe modifié avec succès ! Redirection vers la page de connexion...
      </div>

      <button type="submit" class="submit-button" [disabled]="loading">
        <span *ngIf="!loading">Réinitialiser le mot de passe</span>
        <span *ngIf="loading">
          <svg class="spinner" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#E2E8F0" stroke-width="4"/>
            <path d="M12 2C13.3132 2 14.6136 2.25866 15.8268 2.7612C17.0401 3.26375 18.1425 4.00035 19.0711 4.92893C19.9997 5.85752 20.7362 6.95991 21.2388 8.17317C21.7413 9.38642 22 10.6868 22 12" stroke="#0F5E3E" stroke-width="4" stroke-linecap="round"/>
          </svg>
          Réinitialisation en cours...
        </span>
      </button>

      <div class="back-to-login">
        <a [routerLink]="['/login']" class="back-link">← Retour à la connexion</a>
      </div>
    </form>

    <div class="reset-password-footer" *ngIf="!verifyingToken && tokenValid">
      <p><strong>Note :</strong> Après réinitialisation, vous pourrez vous connecter avec votre nouveau mot de passe.</p>
    </div>
  </div>
</div>