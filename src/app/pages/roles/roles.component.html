<div class="page-header">
  <h1>Gestion des Rôles</h1>
  <button class="btn-primary" (click)="openCreateModal()">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    Nouveau Rôle
  </button>
</div>

<div class="content-card">
  <div class="card-header">
    <div>
      <h2>Rôles du Système</h2>
      <p class="card-subtitle">Gérez les rôles et leurs permissions</p>
    </div>
  </div>

  <div class="search-bar">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
      <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <input
      type="text"
      placeholder="Rechercher un rôle..."
      [(ngModel)]="searchQuery"
      (input)="onSearch()"
    />
  </div>

  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>Nom du Rôle</th>
          <th>Description</th>
          <th>Utilisateurs</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let role of filteredRoles">
          <td>
            <span class="role-name">{{ role.libelle }}</span>
          </td>
          <td>
            <span class="role-description" *ngIf="role.libelle === 'ADMIN'">Administrateur système</span>
            <span class="role-description" *ngIf="role.libelle === 'INSPECTEUR'">Inspecteur des examens</span>
            <span class="role-description" *ngIf="role.libelle !== 'ADMIN' && role.libelle !== 'INSPECTEUR'">
              Rôle personnalisé
            </span>
          </td>
          <td>
            <span class="user-count"></span>
          </td>
          <td>
            <span class="badge badge-active">Actif</span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn-icon" (click)="openEditModal(role)" title="Modifier">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M18.5 2.50001C18.8978 2.10219 19.4374 1.87869 20 1.87869C20.5626 1.87869 21.1022 2.10219 21.5 2.50001C21.8978 2.89784 22.1213 3.4374 22.1213 4.00001C22.1213 4.56262 21.8978 5.10219 21.5 5.50001L12 15L8 16L9 12L18.5 2.50001Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <button class="btn-icon btn-danger" (click)="deleteRole(role)" title="Supprimer">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <polyline points="3 6 5 6 21 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Modifier le Rôle' : 'Nouveau Rôle' }}</h2>
      <button class="close-btn" (click)="closeModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <p class="modal-description">
      {{ isEditMode ? 'Modifiez les informations du rôle.' : 'Créez un nouveau rôle pour le système.' }}
    </p>

    <form (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="libelle">Nom du Rôle</label>
        <input
          type="text"
          id="libelle"
          name="libelle"
          [(ngModel)]="roleForm.libelle"
          placeholder="INSPECTEUR"
          required
        />
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea
          id="description"
          rows="3"
          placeholder="Description du rôle..."
        ></textarea>
      </div>

      <div class="form-group">
        <label class="toggle-label">
          <span>Statut</span>
          <div class="toggle-wrapper">
            <input type="checkbox" checked />
            <span class="toggle-slider"></span>
          </div>
        </label>
        <p class="form-hint">Le rôle est actif et peut être assigné</p>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeModal()">Annuler</button>
        <button type="submit" class="btn-primary">
          {{ isEditMode ? 'Enregistrer' : 'Créer' }}
        </button>
      </div>
    </form>
  </div>
</div>
