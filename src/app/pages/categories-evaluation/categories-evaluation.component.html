<div class="page-header">
  <h1>Catégories d'Évaluation</h1>
  <button class="btn-primary" (click)="openCreateModal()">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    Nouvelle Catégorie
  </button>
</div>

<div class="content-card">
  <div class="card-header">
    <div>
      <h2>Liste des Catégories</h2>
      <p class="card-subtitle">Gérez les catégories d'évaluation par type de permis</p>
    </div>
    <div class="view-toggle">
      <button class="btn-icon" [class.active]="viewMode === 'grid'" (click)="toggleViewMode('grid')" title="Vue grille">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="3" width="7" height="7" stroke="currentColor" stroke-width="2"/>
          <rect x="14" y="3" width="7" height="7" stroke="currentColor" stroke-width="2"/>
          <rect x="3" y="14" width="7" height="7" stroke="currentColor" stroke-width="2"/>
          <rect x="14" y="14" width="7" height="7" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
      <button class="btn-icon" [class.active]="viewMode === 'table'" (click)="toggleViewMode('table')" title="Vue tableau">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <line x1="4" y1="4" x2="20" y2="4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="4" y1="12" x2="20" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="4" y1="20" x2="20" y2="20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="8" y1="2" x2="8" y2="22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="16" y1="2" x2="16" y2="22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="search-bar">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
      <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <input
      type="text"
      placeholder="Rechercher une catégorie..."
      [(ngModel)]="searchQuery"
      (input)="onSearch()"
    />
  </div>

  <!-- Vue Grille -->
  <div class="categories-grid" *ngIf="viewMode === 'grid'">
    <div class="category-card" *ngFor="let categorie of getPaginatedCategories()">
      <div class="category-header">
        <h3>{{ categorie.nom }}</h3>
        <span class="type-badge">{{ categorie.typePermis }}</span>
      </div>
      
      <div class="category-details">
        <div class="category-detail-item">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Score Maximum: <span class="score-value">{{ categorie.scoreMax }} points</span></span>
        </div>
        
        <div class="category-detail-item" *ngIf="categorie.criteresTemplate?.criteres?.length">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15M9 5C9 6.10457 9.89543 7 11 7H13C14.1046 7 15 6.10457 15 5M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5M12 12H15M12 16H15M9 12H9.01M9 16H9.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>{{ categorie.criteresTemplate.criteres.length }} critère(s)</span>
        </div>
      </div>
      
      <div class="category-actions">
        <button class="btn-icon" (click)="openEditModal(categorie)" title="Modifier">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M18.5 2.50001C18.8978 2.10219 19.4374 1.87869 20 1.87869C20.5626 1.87869 21.1022 2.10219 21.5 2.50001C21.8978 2.89784 22.1213 3.4374 22.1213 4.00001C22.1213 4.56262 21.8978 5.10219 21.5 5.50001L12 15L8 16L9 12L18.5 2.50001Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button class="btn-icon btn-danger" (click)="deleteCategorie(categorie)" title="Supprimer">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <polyline points="3 6 5 6 21 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Vue Tableau -->
  <div class="table-container" *ngIf="viewMode === 'table'">
    <table class="data-table">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Type Permis</th>
          <th>Score Maximum</th>
          <th>Nombre de Critères</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let categorie of getPaginatedCategories()">
          <td><span class="dossier-number">{{ categorie.nom }}</span></td>
          <td>
            <span class="type-badge">{{ categorie.typePermis }}</span>
          </td>
          <td><span class="score-value">{{ categorie.scoreMax }} points</span></td>
          <td>{{ categorie.criteresTemplate?.criteres?.length || 0 }}</td>
          <td>
            <div class="action-buttons">
              <button class="btn-icon" (click)="openEditModal(categorie)" title="Modifier">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M18.5 2.50001C18.8978 2.10219 19.4374 1.87869 20 1.87869C20.5626 1.87869 21.1022 2.10219 21.5 2.50001C21.8978 2.89784 22.1213 3.4374 22.1213 4.00001C22.1213 4.56262 21.8978 5.10219 21.5 5.50001L12 15L8 16L9 12L18.5 2.50001Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <button class="btn-icon btn-danger" (click)="deleteCategorie(categorie)" title="Supprimer">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <polyline points="3 6 5 6 21 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- État vide -->
  <div *ngIf="filteredCategories.length === 0" class="empty-state">
    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M9 12H15M9 16H15M9 8H15M5 21H19C20.1046 21 21 20.1046 21 19V5C21 3.89543 20.1046 3 19 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <h3>Aucune catégorie trouvée</h3>
    <p>Les catégories d'évaluation apparaîtront ici lorsqu'elles seront créées.</p>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="filteredCategories.length > 0">
    <div class="pagination-info">
      <span>Page {{ currentPage }} sur {{ totalPages }}</span>
      <span class="items-count">
        {{ getPaginatedCategories().length }} sur {{ filteredCategories.length }} résultats
      </span>
    </div>
    
    <div class="pagination-controls">
      <button 
        class="btn-pagination" 
        (click)="previousPage()"
        [disabled]="currentPage === 1">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Précédent
      </button>
      
      <div class="page-numbers">
        <button 
          *ngFor="let page of getPageNumbers()"
          class="page-number"
          [class.active]="currentPage === page"
          (click)="goToPage(page)">
          {{ page }}
        </button>
      </div>
      
      <button 
        class="btn-pagination" 
        (click)="nextPage()"
        [disabled]="currentPage === totalPages">
        Suivant
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- Modal pour créer/modifier une catégorie -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Modifier la Catégorie' : 'Nouvelle Catégorie' }}</h2>
      <button class="close-btn" (click)="closeModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <p class="modal-description">
      {{ isEditMode ? 'Modifiez les informations de la catégorie.' : 'Créez une nouvelle catégorie d\'évaluation.' }}
    </p>

    <form (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="nom">Nom de la catégorie</label>
        <input
          type="text"
          id="nom"
          name="nom"
          [(ngModel)]="categorieForm.nom"
          placeholder="Ex: Contrôle du véhicule"
          required
        />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="typePermis">Type de Permis</label>
          <select
            id="typePermis"
            name="typePermis"
            [(ngModel)]="categorieForm.typePermis"
            required
          >
            <option value="">Sélectionner un type</option>
            <option *ngFor="let type of typesPermis" [value]="type.code">
              {{ type.libelle }} ({{ type.code }})
            </option>
          </select>
        </div>
        <div class="form-group">
          <label for="scoreMax">Score Maximum</label>
          <input
            type="number"
            id="scoreMax"
            name="scoreMax"
            [(ngModel)]="categorieForm.scoreMax"
            placeholder="Ex: 10"
            min="1"
            max="100"
            required
          />
        </div>
      </div>

      <!-- Section critères -->
      <div class="criteres-section">
        <h4>Critères d'évaluation</h4>
        <div *ngFor="let critere of categorieForm.criteresTemplate.criteres; let i = index" class="critere-item">
          <input
            type="text"
            [(ngModel)]="critere.nom"
            [ngModelOptions]="{standalone: true}"
            placeholder="Nom du critère"
            required
          />
          <input
            type="number"
            class="critere-points"
            [(ngModel)]="critere.points"
            [ngModelOptions]="{standalone: true}"
            placeholder="Points"
            min="1"
            max="10"
            required
          />
          <button type="button" class="remove-critere-btn" (click)="removeCritere(i)" title="Supprimer ce critère">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
        <button type="button" class="add-critere-btn" (click)="addCritere()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          Ajouter un critère
        </button>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeModal()">Annuler</button>
        <button type="submit" class="btn-primary" [disabled]="loading">
          {{ isEditMode ? 'Enregistrer' : 'Créer' }}
        </button>
      </div>
    </form>
  </div>
</div>